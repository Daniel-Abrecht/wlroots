From 422d9fdc4aa8ff781a2efe5654486a636966e662 Mon Sep 17 00:00:00 2001
From: Scott Anderson <scott@anderso.nz>
Date: Fri, 24 Jan 2020 20:37:34 +1300
Subject: [PATCH 09/14] meson: Fix protocol includes for compositor examples

(cherry picked from commit 70a084c119695c7d82b4e3a97c35555d0af91d62)
---
 backend/wayland/meson.build |  2 +-
 examples/meson.build        | 10 ++++++++--
 protocol/meson.build        |  8 +++++---
 3 files changed, 14 insertions(+), 6 deletions(-)

diff --git a/backend/wayland/meson.build b/backend/wayland/meson.build
index 73336d20..f5a83562 100644
--- a/backend/wayland/meson.build
+++ b/backend/wayland/meson.build
@@ -16,5 +16,5 @@ client_protos = [
 ]
 
 foreach proto : client_protos
-	wlr_files += get_variable(proto.underscorify() + '_h')
+	wlr_files += get_variable(proto.underscorify() + '_client_h')
 endforeach
diff --git a/examples/meson.build b/examples/meson.build
index 90ac7611..c52ef57c 100644
--- a/examples/meson.build
+++ b/examples/meson.build
@@ -42,6 +42,7 @@ compositors = {
 	},
 	'fullscreen-shell': {
 		'src': 'fullscreen-shell.c',
+		'proto': ['fullscreen-shell-unstable-v1'],
 	},
 }
 
@@ -151,9 +152,14 @@ clients = {
 }
 
 foreach name, info : compositors
+	extra_src = []
+	foreach p : info.get('proto', [])
+		extra_src += get_variable(p.underscorify() + '_server_h')
+	endforeach
+
 	executable(
 		name,
-		info.get('src'),
+		[info.get('src'), extra_src],
 		dependencies: wlroots,
 		include_directories: [wlr_inc, proto_inc],
 		build_by_default: get_option('examples'),
@@ -164,7 +170,7 @@ foreach name, info : clients
 	extra_src = []
 	foreach p : info.get('proto')
 		extra_src += get_variable(p.underscorify() + '_c')
-		extra_src += get_variable(p.underscorify() + '_h')
+		extra_src += get_variable(p.underscorify() + '_client_h')
 	endforeach
 
 	executable(
diff --git a/protocol/meson.build b/protocol/meson.build
index b9aa49c7..1f295df0 100644
--- a/protocol/meson.build
+++ b/protocol/meson.build
@@ -53,14 +53,15 @@ foreach name, path : protocols
 	)
 	wlr_files += code
 
-	wlr_files += custom_target(
+	server_header = custom_target(
 		name.underscorify() + '_server_h',
 		input: path,
 		output: '@BASENAME@-protocol.h',
 		command: [wayland_scanner, 'server-header', '@INPUT@', '@OUTPUT@'],
 	)
+	wlr_files += server_header
 
-	header = custom_target(
+	client_header = custom_target(
 		name.underscorify() + '_client_h',
 		input: path,
 		output: '@BASENAME@-client-protocol.h',
@@ -69,5 +70,6 @@ foreach name, path : protocols
 	)
 
 	set_variable(name.underscorify() + '_c', code)
-	set_variable(name.underscorify() + '_h', header)
+	set_variable(name.underscorify() + '_server_h', server_header)
+	set_variable(name.underscorify() + '_client_h', client_header)
 endforeach
-- 
2.26.0

